#+STARTUP: content
#+CREATED: [2021-08-23 11:23]
* document-transition
** Refers
   - https://developer.chrome.com/en/blog/shared-element-transitions-for-spas/
** preview
   目前需要试用提案, 有两种方式:
   1. 网站注册试用 token
      Chrome 92 版本起, 允许使用 ~shared element transions API~, 可以通过域名试用的方式启用.
      预计约 94 版本结束试用, [[https://github.com/GoogleChrome/OriginTrials/blob/gh-pages/developer-guide.md#valid-until-feedback][更多]]

   2. Chrome 客户端主动启动 chrome 设置
      Chrome 启用设置(默认关闭): ~chrome://flags/#document-transition~
   
   DEMO:
   - https://transition.surge.sh/
   - https://preact-with-nav-transitions.netlify.app/guide/v10/getting-started

   网站主动启用设置方式:
   1. 注册一个 token https://developer.chrome.com/origintrials/#/view_trial/451485862643892225
   2. 添加到你的页面:
      - 添加到 meta 里 ~<meta http-equiv="origin-trial" content="TOKEN_GOES_HERE">~
      - 添加到 response heeder 中 ~Origin-Trial: TOKEN_GOES_HERE~ 

   Web 提案: https://github.com/WICG/shared-element-transitions/
** 使用
*** 环境
    判断是否支持
    #+begin_src js
      if ('documentTransition' in document) {
	// Feature supported
      }
    #+end_src
*** 简单动画使用
    #+begin_src js
      // 点击页面跳转
      async function navigateToSettingsPage() {
        // 录制快照, 准备动画
	await document.documentTransition.prepare({
	  rootTransition: 'cover-left',
	});

	// 页面元素变化, 如 router 中执行元素更换和路由变化
	updateDOMForSettingsPage();

        // 执行动画
	await document.documentTransition.start();
      }
    #+end_src

    Steps
    1. ~prepare~ 会保留当前虚拟数据的快照
    2. 更新 DOM 展示, 代理新页面
    3. 执行 ~start~ 展示动画

*** 共享元素动画
    
    
** 限制:
   1. 动画基于 DOM 动态执行, 内置 CSS 动画或者 gif 会处于静止状态
   2. 动画基于整个 DOM, 暂时不支持仅对部分 UI
   3. 对动画的控制受限, 不能主动控制开始结束和长度
